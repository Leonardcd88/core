<link rel="import" href="../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-menu/core-menu.html">

<link rel="import" href="../bower_components/core-style/core-style.html">

<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="../layouts/partial-states.html">
<link rel="import" href="../layouts/partial-history.html">
<link rel="import" href="../layouts/partial-dev-fire-event.html">
<link rel="import" href="../layouts/partial-dev-call-service.html">
<link rel="import" href="../layouts/partial-dev-set-state.html">

<polymer-element name="home-assistant-main" attributes="api">
<template>
  <core-style ref="ha-headers"></core-style>

  <style>
    core-header-panel {
      background: #fafafa;
      box-shadow: 1px 0 1px rgba(0, 0, 0, 0.1);
      color: #757575;
      overflow: hidden;
    }

    core-menu core-icon {
      margin-right: 24px;
    }

    core-toolbar {
      font-weight: normal;
      padding-left: 24px;
    }

    core-menu {
      overflow: scroll;
      position: absolute;
      top: 0px;
      left: 0px;
      right: 0px;
      bottom: 0px;
    }

    paper-item {
      min-height: 53px;
    }

    .seperator {
      padding: 16px;
      font-size: 14px;
      border-top: 1px solid #e0e0e0; 
    }

    .seperator ~ paper-item {

    }
  </style>

  <core-drawer-panel id="drawer" on-core-responsive-change="{{responsiveChanged}}">
    <core-header-panel mode="scroll" drawer>
      <core-toolbar>
        Home Assistant
      </core-toolbar>
      <core-menu
        selected="0" excludedLocalNames="div" on-core-select="{{menuSelect}}"
        layout vertical>
        <paper-item data-panel="states">
          <core-icon icon="apps"></core-icon>
          States
        </paper-item>
        <paper-item data-panel="group">
          <core-icon icon="homeassistant-24:group"></core-icon>
          Groups
        </paper-item>
        <paper-item data-panel="history">
          <core-icon icon="assessment"></core-icon>
          History
        </paper-item>

        <div flex></div>

        <paper-item id="logout" on-click="{{handleLogOutClick}}">
          <core-icon icon="exit-to-app"></core-icon>
          Log Out
        </paper-item>

        <div class='seperator'>Developer Tools</div>
        <paper-item data-panel="call-service">
          <core-icon icon="settings-remote"></core-icon>
          Call Service
        </paper-item>
        <paper-item data-panel="set-state">
          <core-icon icon="settings-ethernet"></core-icon>
          Set State
        </paper-item>
        <paper-item data-panel="fire-event">
          <core-icon icon="settings-input-antenna"></core-icon>
          Fire Event
        </paper-item>
      </core-menu>
    </core-header-panel>

    <template if="{{selected == 'states' || selected == 'group'}}">
      <partial-states
        main narrow="{{narrow}}"
        togglePanel="{{togglePanel}}"
        filter="{{selected == 'group' ? 'group' : null}}">
      </partial-states>
    </template>
    <template if="{{selected == 'history'}}">
      <partial-history main narrow="{{narrow}}" togglePanel="{{togglePanel}}"></partial-history>
    </template>
    <template if="{{selected == 'fire-event'}}">
      <partial-dev-fire-event main narrow="{{narrow}}" togglePanel="{{togglePanel}}"></partial-dev-fire-event>
    </template>
    <template if="{{selected == 'set-state'}}">
      <partial-dev-set-state main narrow="{{narrow}}" togglePanel="{{togglePanel}}"></partial-dev-set-state>
    </template>
    <template if="{{selected == 'call-service'}}">
      <partial-dev-call-service main narrow="{{narrow}}" togglePanel="{{togglePanel}}"></partial-dev-call-service>
    </template>
  </core-drawer-panel>

</template>
<script>
Polymer({
  selected: "states",
  narrow: false,

  ready: function() {
    this.togglePanel = this.togglePanel.bind(this);
  },

  menuSelect: function(ev, detail, sender) {
    if (detail.isSelected) {
      var newChoice = detail.item.dataset.panel;

      if(newChoice !== this.selected) {
        this.togglePanel();
        this.selected = newChoice;
      }
    }
  },

  responsiveChanged: function(ev, detail, sender) {
    this.narrow = detail.narrow;
  },

  togglePanel: function() {
    this.$.drawer.togglePanel();
  },

  handleLogOutClick: function() {
    window.hass.authActions.logOut();
  },

});
</script>  
</polymer-element>
