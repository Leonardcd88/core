<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input-decorator.html">
<link rel="import" href="../bower_components/paper-input/paper-autogrow-textarea.html">

<link rel="import" href="./partial-base.html">

<link rel="import" href="../components/services-list.html">

<polymer-element name="partial-dev-call-service" attributes="narrow togglePanel">
<template>

  <style>
  .form {
    padding: 24px;
  }
  </style>

  <partial-base narrow="{{narrow}}" togglePanel="{{togglePanel}}">
    <span header-title>Call Service</span>

    <div layout horizontal?="{{!narrow}}" vertical?="{{narrow}}" class='form'  flex?="{{!narrow}}">
      <div class='ha-form'>
        <paper-input id="inputDomain" label="Domain" floatingLabel="true" autofocus required></paper-input>
        <paper-input id="inputService" label="Service" floatingLabel="true" required></paper-input>
        <paper-input-decorator
          label="Service Data (JSON, optional)"
          floatingLabel="true">
          
          <paper-autogrow-textarea id="inputDataWrapper">
            <textarea id="inputData"></textarea>
          </paper-autogrow-textarea>
          
        </paper-input-decorator>
        <paper-button on-click={{clickCallService}}>Call Service</paper-button>
      </div>

      <div class='sidebar'>
        <b>Available services:</b>
        <services-list api={{api}} cbServiceClicked={{serviceSelected}}></event-list>        
      </div>
    </div>



  </partial-base>

</template>
<script>
Polymer({
  ready: function() {
    // to ensure callback methods work..
    this.serviceSelected = this.serviceSelected.bind(this);
  },

  setService: function(domain, service) {
    this.$.inputDomain.value = domain;
    this.$.inputService.value = service;
  },

  serviceSelected: function(domain, service) {
    this.setService(domain, service);
  },

  clickCallService: function() {
    try {
      window.hass.serviceActions.callService(
        this.$.inputDomain.value,
        this.$.inputService.value,
        this.$.inputData.value ? JSON.parse(this.$.inputData.value) : {});
    } catch (err) {
      alert("Error parsing JSON: " + err);
    }
  }

});
</script>
</polymer-element>
